---
title: "Project 2: Yield Curves as Recession Indicators"
author: "Hyekyung Min"
date: "2023-08-01"
format: html
editor: visual
execute:
  warning: false
---

### Learning Objectives

1.  Understand the concept of yield spreads and their significance as a leading indicator of economic recession.

2.  Apply probit regression methods for binary classification and formulate a yield spread model to predict the probability of recession.

3.  Evaluate the effectiveness of probit regression in binary classification using a confusion matrix and ML metrics such as accuracy, precision, sensitivity, specificity, F1-score, ROC curve, and AUC.

### Yield Spread

The yield spread, often referred to as the yield curve's slope, is the difference between long-term and short-term bond yields. Treasury notes and bonds maturing in 10 years or more are classified as long term, while Treasury bills with a maturity of 1 year or less are short term. When short-term bond yields exceed long-term bond yields, the yield spread becomes negative, leading to an inverted yield curve. Historically, these inversions have often come before economic recessions, making a negative yield spread a key indicator of possible recession.

The yield spread, defined as the difference between the 10-year yield rate and the 3-month yield rate, along with the National Bureau of Economic Research (NBER) recession indicator, is accessible through the Federal Research Economic Data (FRED) from 1959 until the current year. On a monthly basis, NBER economists retrospectively review a range of indicators to determine whether the economy has experienced a recession in recent months. We plot the yield spreads together with the recession indicator using the FRED data.

> 1.  Download the yield spread and NBER recession indicator data from the New York Federal Reserve https://www.newyorkfed.org/research/capital_markets/ycfaq#/
>
> 2.  Create a plot showing yield spreads from 1959 to 2023 and highlight recession months on that graph.
>
> 3.  Examine the plot to identify periods of negative yield spread, compare them with the NBER recession months, and investigate the historical links to economic recessions.

```{r}
library(readxl)
library(tidyverse)
library(dyn)
library(caret)
library(pROC)

yield_monthly <- read_excel("New York Fed Yield Curve Monthly Data.xls",  col_types = c("date", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"))

# Plotting yield spread + NBER recession indicators
background <- yield_monthly[yield_monthly$NBER_Rec == 1,]
background$end <- background$Date %m+% period("1 month")
ggplot(yield_monthly, aes(x = Date, y = Spread)) +
  geom_line(color = "orange") +
  geom_rect(ymin = -Inf, ymax = Inf, aes(xmin = Date, xmax = end), data = background, fill = "deepskyblue4", alpha = 0.3) +
  xlab("Year") +
  ylab("Yield Spread")
```

### Yield Spread Regression Model for Predicting Recessions

Probit regression is used with time series data of yield spreads (\$X_t\$) and NBER recession indicators (\$Y_t\$). The model predicts the probability of a recession occurring one year ahead based on yield spread as follows:

$$\mathbb{P}(Y_t=1|X_{t-12}) =\Phi(\beta_0+\beta_1X_{t-12})
$$

Here $\Phi(\cdot)$ is a standard normal c.d.f. and $Y_t=1$ indicates that the month $t$ is in recession.

The `dyn` package in R can be applied for managing time series data, incorporating time lags, and performing regression.

> 1.  Build and interpret a probit regression model with time series data and 1-year time lag.
>
> 2.  Predict the probability of a recession using the model. What is the probability of a recession for a zero yield spread forecasting 1 year ahead?
>
> 3.  Create recession indicators by comparing the projected probabilities with the recession probability established at a zero yield spread.

```{r}
mod <- NBER_Rec ~ stats::lag(Spread, k = -12)
rec.glm <- dyn$glm(mod, family = binomial(link = "probit"), data = yield_monthly)
summary(rec.glm)
yield_monthly$rec_prob <- NA
yield_monthly$rec_prob[-c(1:12)] <- fitted(rec.glm)
confint(rec.glm)
rp.cutoff <- pnorm(coef(rec.glm)[1])
yield_monthly$rec <- ifelse(yield_monthly$rec_prob > rp.cutoff, 1, 0)
```

### Evaluating Yield Spread Regression Performance

A confusion matrix is a table used in classification to summarize a model's performance. It presents the counts of true positives (TP), true negatives (TN), false positives (FP), and false negatives (FN) generated by the model, as shown below.

|                 |             |              |
|:---------------:|:-----------:|:------------:|
|                 | Actual True | Actual False |
| Predicted True  |     TP      |      FP      |
| Predicted False |     FN      |      TN      |

Based on the confusion matrix, various metrics can be computed to evaluate the model's performance and misclassifications. Here are examples of such metrics.

-   Accuracy = Rate of Correct Predictions Among All Predictions = \$\frac{TP+TN}{TP+TN+FP+FN}\$

-   Precision = Rate of True Positives Among All Positive Predictions = \$\frac{TP}{TP+FP}\$

-   Sensitivity = Rate of True Positives Among All Actual Positive Cases = \$\frac{TP}{TP+FN}\$

-   Specificity = Rate of True Negatives Among All Actual. Negative Cases = \$\frac{TN}{TN+FP}\$

-   F1-Score = Harmonic Mean of Precision and Sensitivity = \$\frac{2(\text{Precision$\cdot$Sensitivity})}{\text{Precision$+$Sensitivity}}\$

-   ROC (Receiver Operating Characteristic) Curve = Plot of Sensitivity Against 1 - Specificity at Different Classification Thresholds

-   AUC = Area Under the ROC Curve

In the context of our imbalanced data, the F1 score is particularly useful considering the limited occurrence of recession months. Additionally, the ROC curve provides how the model performs across various thresholds. The `caret` and `pROC` packages in R are used to compute these metrics.

> 1.  Create the confusion matrix of the probit regression model.
> 2.  Using the confusion matrix, compute several metrics such as accuracy, precision, sensitivity, specificity, F1-score, ROC curve, and AUC and evaluate the model's performance.
> 3.  Find the best threshold using the `coords()` command from the R `pROC` package, which maximizes the Youden's index of sensitivity and specificity.

```{r}
#Confusion matrix
actual <- as.factor(yield_monthly$NBER_Rec)
predicted <- as.factor(yield_monthly$rec)
rec.len <- length(predicted)
predicted[(rec.len - 11): rec.len] <- NA
conf_matrix <- confusionMatrix(table(predicted, actual))
conf_matrix
precision <- precision(predicted, actual)
precision
f1_score <- conf_matrix$byClass["F1"]
f1_score

#Plotting ROC Curve
roc_data <- roc(actual, yield_monthly$rec_prob)
plot(roc_data) #wrong label for x-axis? Correct one = FPR = 1-Specificity?
auc(roc_data)
optimal_point <- coords(roc_data, "best")
optimal_point

# Plot the ROC curve using ggplot2
roc_curve <- data.frame(FPR = 1-roc_data$specificities,
                        TPR = roc_data$sensitivities)
roc_plot <- ggplot(roc_curve, aes(x = FPR, y = TPR)) +
  geom_line() +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +  
  labs(title = "ROC Curve", x = "1-Specificity", y = "Sensitivity")
print(roc_plot)
```

### References

Estrella, Arturo and Mishkin, Frederic S., *The Yield Curve as a Predictor of U.S. Recessions*. Current Issues in Economics and Finance, Vol. 2, No. 7, June 1996, Available at SSRN: <https://ssrn.com/abstract=1001228> or [http://dx.doi.org/10.2139/ssrn.1001228](https://dx.doi.org/10.2139/ssrn.1001228).

Federal Reserve Bank of New York, *The Yield Curve as a Leading Indicator*, <https://www.newyorkfed.org/research/capital_markets/ycfaq.html>.

Gareth James, Daniela Witten, Trevor Hastie, Robert Tibshirani. *An Introduction to Statistical Learning*: with Applications in R. New York: Springer, 2013.

Michael D. Bauer & Thomas M. Mertens, 2018. *Economic Forecasts with the Yield Curve*, [FRBSF Economic Letter](https://ideas.repec.org/s/fip/fedfel.html), Federal Reserve Bank of San Francisco.
